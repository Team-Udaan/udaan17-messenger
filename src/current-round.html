<dom-module id="current-round">

  <template>

    <style>
      :host {
        display: block;
        @apply(--layout-vertical);
      }

      #send {
        @apply(--action-button);
        @apply(--layout-self-center);
        width: 100px;
      }

      paper-dialog {
        width: 70vw;
      }
    </style>

    <app-location route="{{route}}" use-hash-as-path></app-location>

    <!-- Todo: Add URL -->
    <iron-ajax url="{{url}}"
               method="POST"
               content-type="application/json"
               body="{{selectedParticipants}}"
               last-response="{{participation}}"
               on-error="handleError"
               loading="{{loading}}">
    </iron-ajax>

    <paper-datatable id="table" data="[[participation]]" selectable multi-selection
                     selected-items="{{selectedParticipations}}">
      <paper-datatable-column header="Receipt Number" property="receiptNo">
        <template>[[item.receiptNo]]</template>
      </paper-datatable-column>
      <paper-datatable-column header="Name" property="name">
        <template>[[item.name]]</template>
      </paper-datatable-column>
      <paper-datatable-column header="Mobile Number" property="mobile">
        <template>[[item.mobile]]</template>
      </paper-datatable-column>
    </paper-datatable>

    <paper-button id="send" raised on-tap="confirmSend" disabled="{{isEmpty(selectedParticipations)}}">Send
    </paper-button>

    <paper-dialog id="confirmationDialog" modal
                  entry-animation="scale-up-animation"
                  exit-animation="scale-down-animation">
      <div>
        Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium, aperiam, qui! Consequuntur culpa delectus
        dignissimos doloremque doloribus eum ipsa laudantium, modi pariatur perferendis quo saepe suscipit voluptate?
        Accusantium, beatae, ullam.
      </div>
      <div class="buttons">
        <paper-button on-tap="sendMessages">Confirm Send</paper-button>
        <paper-button on-tap="closeModal">Close</paper-button>
      </div>
    </paper-dialog>

  </template>

  <script>
    Polymer({

      is: 'current-round',

      properties: {
        participation: {
          type: Array,
          value: function () {
            return [
              {
                'id': 1,
                'receiptNo': 'A/01/055',
                'name': 'Mukesh Kumar',
                'mobile': '9876543120'
              },
              {
                'id': 2,
                'receiptNo': 'A/02/056',
                'name': 'Manish Kumar',
                'mobile': '7894561320'
              }
            ]
          }
        }
      },

      isEmpty: function (array) {
        return array.length == 0;
      },

      confirmSend: function () {
        this.selectedIds = this.$.table.selectedItems.map(function (item) {
          return item.id;
        });
        this.$.confirmationDialog.open();

      },

      sendMessages: function () {
        // Todo: Add send logic
        this.$.confirmationDialog.close();
        this.set('route.path', '/failed');
      },

      closeModal: function () {
        this.$.confirmationDialog.close();
      }

    });
  </script>

</dom-module>
